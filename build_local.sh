#!/bin/bash

# スクリプトのエラーハンドリングを設定
set -e

echo "----------------------------------------------"
echo "🗑️  node_modulesとpackage-lock.jsonを削除中..."
echo "----------------------------------------------"
rm -rf node_modules package-lock.json

echo "----------------------------------------------"
echo "🧹 npmキャッシュをクリア中..."
echo "----------------------------------------------"
npm cache clean --force

echo "----------------------------------------------"
echo "📦 依存関係を再インストール中..."
echo "----------------------------------------------"
npm install

echo "----------------------------------------------"
echo "🗑️  古いビルド成果物を削除中..."
echo "----------------------------------------------"
rm -rf .output

echo "----------------------------------------------"
echo "🏗️ ビルドプロセスを実行中..."
echo "----------------------------------------------"
NITRO_PRESET=cloudflare npm run build

echo "✅ ビルドが正常に完了しました。"
